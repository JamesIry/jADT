<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 | Generated by Apache Maven Doxia at Jun 24, 2012
 | Rendered using Apache Maven Fluido Skin 1.2.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title></title>
    <link rel="stylesheet" href="./css/apache-maven-fluido.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido.min.js"></script>

    
    <meta name="Date-Revision-yyyymmdd" content="20120624" />
    <meta http-equiv="Content-Language" content="en" />
    
        </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="index.html" id="bannerLeft" title="jADT : Java Algebraic DataTypes">
                                                                                                <img src="images/jadt.png"  alt="jADT : Java Algebraic DataTypes"/>
                </a>
                      </div>
        <div class="pull-right">                  <a href="https://github.com/jamesiry/jADT/" id="bannerRight" title="Fork me on GitHub">
                                                                                        <img src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"  alt="Fork me on GitHub"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
            
                  <li id="publishDate">Last Published: 2012-06-24</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 0.2.0</li>
                          <li class="divider">|</li>             <li class="">
                    <a href="index.html" title="jADT">jADT</a>
        <li class="divider ">/</li>
      </li>
    <li class=""></li>
              
                
            
      
                                  
    <li class="pull-right">              <a href="http://james-iry.blogspot.com" class="externalLink" title="James Iry's blog   ">James Iry's blog   </a>
  </li>

                        </ul>
      </div>

            <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
            
                                    <h3>jADT Manual</h3>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="About">About</a>
            </li>
                  <li class="none">
                          <a href="jadt_license.html" title="License">License</a>
            </li>
                  <li class="none">
                          <a href="download.html" title="Download">Download</a>
            </li>
                  <li class="none">
                          <a href="why_adt.html" title="Why use ADTs?">Why use ADTs?</a>
            </li>
                  <li class="none">
                          <a href="what_adt.html" title="What is an ADT?">What is an ADT?</a>
            </li>
                  <li class="none">
            <strong>Visitor Pattern</strong>
          </li>
                  <li class="none">
                          <a href="how_adt.html" title="How can ADTs be used?">How can ADTs be used?</a>
            </li>
                  <li class="none">
                          <a href="visitor_variations.html" title="Visitor Variations">Visitor Variations</a>
            </li>
                  <li class="none">
                          <a href="shell_generation.html" title="Generating Java from the Shell">Generating Java from the Shell</a>
            </li>
                  <li class="none">
                          <a href="maven_generation.html" title="Generating Java from Apache Maven">Generating Java from Apache Maven</a>
            </li>
                  <li class="none">
                          <a href="ant_generation.html" title="Generating Java from Apache Ant">Generating Java from Apache Ant</a>
            </li>
                  <li class="none">
                          <a href="limitations.html" title="Limitations">Limitations</a>
            </li>
                  <li class="none">
                          <a href="faq.html" title="FAQ">FAQ</a>
            </li>
                  <li class="none">
                          <a href="change_list.html" title="Change List">Change List</a>
            </li>
          </ul>
                        <h3>jADT Specification</h3>
                  <ul>
                  <li class="none">
                          <a href="syntax.html" title="Syntax">Syntax</a>
            </li>
                  <li class="none">
                          <a href="constraints.html" title="Constraints">Constraints</a>
            </li>
          </ul>
                        <h3>Project Documentation</h3>
                  <ul>
                                                                                                                                                                                                                                                                                                              <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                            <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                      
            
                            <form id="search-form" action="http://www.google.com/search" method="get" >
    
  <input value="jamesiry.github.com/jADT/" name="sitesearch" type="hidden"/>
  <input class="span2 search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                                                                                                                   <a href="https://github.com/" title="hosted on GitHub" class="poweredBy">
        <img class="poweredBy"  alt="hosted on GitHub" src="http://github.com/github/media/raw/master/logos/github_logo_social_coding_outlined.png"    />
      </a>
                                                                                                          <a href="http://maven.apache.org/" title="built with Maven 3" class="poweredBy">
        <img class="poweredBy"  alt="built with Maven 3" src="images/logos/maven-feather.png"    />
      </a>
                                                                                                    <a href="http://www.cloudbees.com/dev.cb" title="built on DEV@cloud" class="poweredBy">
        <img class="poweredBy"  alt="built on DEV@cloud" src="http://www.cloudbees.com/sites/default/files/Button-Built-on-CB-1.png"    />
      </a>
                      </div>
          </div>
        </div>
        
        <div id="bodyColumn"  class="span9" >
                                  
            <div class="section"><h2>Visitor Pattern<a name="Visitor_Pattern"></a></h2><p><a href="./what_adt.html">&lt;&lt; What is an Algebraic DataType? </a> | <a href="./how_adt.html"> How Can Algebraic DataTypes be Used? &gt;&gt;</a></p><p>This page gives background information on the Visitor Pattern. Most of the code on this page mimics code that jADT generates for you. If you feel comfortable with Visitors skip ahead to <a href="./how_adt.html">How to Use ADTs</a>.</p><p>First, a quote from the Wikipedia <a class="externalLink" href="http://en.wikipedia.org/wiki/Visitor_pattern">article on Visitor</a>.</p><p><i>In object-oriented programming and software engineering, the visitor design pattern is a way of separating an algorithm from an object structure on which it operates. A practical result of this separation is the ability to add new operations to existing object structures without modifying those structures. It is one way to easily follow the open/closed principle.</i></p><p>Ignoring how it's implemented, Visitor's goal is very similar to Java's switch statement. Given a primitive (int, long, char, etc.) switch allows you to take different action based on which value of type int/long/char/whatever you happen to have. The decision can be made without adding code to a base int/long/char class (indeed, there are no such classes). Visitor allows the same kind of dispatching to be added to a class hierarchy where the dispatch decision is typically based on the specific subclass found at runtime.</p><p>An example Visitor should help - we'll re-implement a method that uses switch to use a Visitor pattern to tie all the concepts together. We'll re-implement this enum and later create a switch replacement.</p><div class="source"><pre class="prettyprint">public enum ColorEnum {
    Red, Green, Blue;
}
</pre></div><p>First, we need an replacement for the enum. Ignore the _switch methods for now.</p><div class="source"><pre class="prettyprint">public interface Color {
    public void _switch(ColorSwitchBlock switchBlock);
}
</pre></div><div class="source"><pre class="prettyprint">public class Red implements Color {
    @Override
    public void _switch(ColorSwitchBlock switchBlock) {
        switchBlock._case(this);
    }

}
</pre></div><div class="source"><pre class="prettyprint">public class Blue implements Color {

    @Override
    public void _switch(ColorSwitchBlock switchBlock) {
        switchBlock._case(this);
    }

}
</pre></div><div class="source"><pre class="prettyprint">public class Green implements Color {
    @Override
    public void _switch(ColorSwitchBlock switchBlock) {
        switchBlock._case(this);
    }

}
</pre></div><p>So a Color is either a Red, a Green, or a Blue. Technically a Color could be any other subclass that anybody wants to write, but the Visitor pattern effectively prevents such subclassing as you'll see shortly. </p><p>The first half of the visitor pattern is the abstract _switch method in the base interface or class and concrete implementations in each subclass. The second half is the visitor interface</p><div class="source"><pre class="prettyprint">public interface ColorSwitchBlock {
    public void _case(Red x);
    public void _case(Blue x);
    public void _case(Green x);
}
</pre></div><p>So anything that implements the ColorSwitchBlock interface can be passed to the _switch method on a Color. That _switch method will call _case(Red), _case(Green), or _case(Blue) on the SwitchBlock. Hence dispatch based on the subclass. That's also why the Visitor pattern effectively prevents adding new subclasses. While it's possible to create class MyOtherColor implemenets Color, the only way to make it useful is to go back and add a _case(MyOtherColor) to ColorSwitchBlock and all its implementations.</p><p>All the Java code you've seen up to now is very similar to the Java that jADT generates. Although jADT seals ADTs against further subclassing and generates <a href="./visitor_variations.html">visitor variations</a> that allow a useful return a useful result and Visitor variations that do default computations so you don't need to implement visit methods for every possible case.</p><p>As promised, we can finally implement an equivalent of a switch statement. We'll create something similar to this simple method.</p><div class="source"><pre class="prettyprint">public void printString(ColorEnum color, PrintWriter writer) {
    switch(color) {
    case Red:
        writer.print(&quot;red&quot;);
        break;
    case Green:
        writer.print(&quot;green&quot;);
        break;
    case Blue:
        writer.print(&quot;blue&quot;);
        break;
    }
}
</pre></div><p>Using the Color interface instead of ColorEnum and implementing a ColorSwitchBlock results in this equivalent method</p><div class="source"><pre class="prettyprint">public void printString(Color color, final PrintWriter writer) {
    color._switch(new ColorSwitchBlock() {            
        @Override
        public void _case(Red x) {
            writer.print(&quot;red&quot;);
        }
        
        @Override
        public void _case(Green x) {
            writer.print(&quot;green&quot;);                
        }
        
        @Override
        public void _case(Blue x) {
            writer.print(&quot;blue&quot;);
        }           
    });
}
</pre></div><p>There's a bit more boilerplate - it's hard to compete with a built in sugar like switch and enum - but the idea is captured. </p><p>While switch covers a lot of territory, two more dispatch mechanisms in Java are if and the ternary operator x?y:z, both of which dispatch on booleans. The ternary operator, unlike switch and if, is an expression instead of a statement meaning it returns a useful value that can be used in larger expressions. Similar to the if vs ternary operator distinction, jADT has <a href="./visitor_variations.html">visitor variations</a> that that can be used in expressions or others that are only called for their effects such as modifying a shared data structure, writing to the network, or printing to the screen. Like Java's switch, it's possible to have a default case in a jADT Visitor.</p><p><a href="./what_adt.html">&lt;&lt; What is an Algebraic DataType? </a> | <a href="./how_adt.html"> How Can Algebraic DataTypes be Used? &gt;&gt;</a></p></div>
                  </div>
            </div>
      
    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span16">Copyright &copy;                   2012.
          All Rights Reserved.      
            
      </div>

                          
        
                </div>
    </footer>
  </body>
</html>

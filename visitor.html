<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 | Generated by Apache Maven Doxia at Jun 12, 2012
 | Rendered using Apache Maven Fluido Skin 1.2.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title></title>
    <link rel="stylesheet" href="./css/apache-maven-fluido.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido.min.js"></script>

    
    <meta name="Date-Revision-yyyymmdd" content="20120612" />
    <meta http-equiv="Content-Language" content="en" />
    
        </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="index.html" id="bannerLeft">
                <h2>JADT : Java Algebraic DataTypes</h2>
                </a>
                      </div>
        <div class="pull-right">                  <a href="https://github.com/jamesiry/JADT/" id="bannerRight">
                                                                                        <img src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"  alt="Fork me on GitHub"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
            
                  <li id="publishDate">Last Published: 2012-06-12</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 0.0.2-SNAPSHOT</li>
                          <li class="divider">|</li>             <li class="">
                    <a href="index.html" title="JADT">JADT</a>
        <li class="divider ">/</li>
      </li>
    <li class=""></li>
              
                
            
      
                                  
    <li class="pull-right">              <a href="http://james-iry.blogspot.com" class="externalLink" title="James Iry's blog   ">James Iry's blog   </a>
  </li>

                        </ul>
      </div>

            <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
            
                                    <h3>JADT Manual</h3>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="About">About</a>
            </li>
                  <li class="none">
                          <a href="jadt_license.html" title="License">License</a>
            </li>
                  <li class="none">
                          <a href="download.html" title="Download">Download</a>
            </li>
                  <li class="none">
                          <a href="why_adt.html" title="Why use ADTs?">Why use ADTs?</a>
            </li>
                  <li class="none">
                          <a href="what_adt.html" title="What is an ADT?">What is an ADT?</a>
            </li>
                  <li class="none">
            <strong>Visitor Pattern</strong>
          </li>
                  <li class="none">
                          <a href="how_adt.html" title="How can ADTs be used?">How can ADTs be used?</a>
            </li>
                  <li class="none">
                          <a href="visitor_variations.html" title="Visitor Variations">Visitor Variations</a>
            </li>
                  <li class="none">
                          <a href="shell_generation.html" title="Generating Java from the Shell">Generating Java from the Shell</a>
            </li>
                  <li class="none">
                          <a href="ant_generation.html" title="Generating Java from Apache Ant">Generating Java from Apache Ant</a>
            </li>
                  <li class="none">
                          <a href="limitations.html" title="Limitations">Limitations</a>
            </li>
                  <li class="none">
                          <a href="faq.html" title="FAQ">FAQ</a>
            </li>
          </ul>
                        <h3>JADT Specification</h3>
                  <ul>
                  <li class="none">
                          <a href="syntax.html" title="JADT syntax">JADT syntax</a>
            </li>
          </ul>
                        <h3>Project Documentation</h3>
                  <ul>
                                                                                                                                                                                                                                                                                                              <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                            <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                      
            
                            <form id="search-form" action="http://www.google.com/search" method="get" >
    
  <input value="jamesiry.github.com/JADT/" name="sitesearch" type="hidden"/>
  <input class="span2 search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
        <div id="bodyColumn"  class="span9" >
                                  
            <div class="section"><h2>Visitor Pattern<a name="Visitor_Pattern"></a></h2><p><a href="./what_adt.html">&lt;&lt; What is an Algebraic DataType? </a> | <a href="./how_adt.html"> How Can Algebraic DataTypes be Used? &gt;&gt;</a></p><p>This page gives background information on the Visitor Pattern. If you feel comfortable with Visitors skip ahead to <a href="./how_adt.html">How to Use ADTs</a>.</p><p>First, a quote from the Wikipedia <a class="externalLink" href="http://en.wikipedia.org/wiki/Visitor_pattern">article on Visitor</a>.</p><p><i>In object-oriented programming and software engineering, the visitor design pattern is a way of separating an algorithm from an object structure on which it operates. A practical result of this separation is the ability to add new operations to existing object structures without modifying those structures. It is one way to easily follow the open/closed principle.</i></p><p>Ignoring how it's implemented, Visitor's goal is very similar to Java's <tt>switch</tt> statement. Given a primitive (int, long, boolean, etc.) <tt>switch</tt> allows you to take different action based on which value of type int/long/boolean/whatever you happen to have. The decision can be made without adding code to a base int/long/boolean class (indeed, there are no such classes). Visitor allows the same kind of dispatching to be added to a class hierarchy where the dispatch decision is typically based on the specific subclass found at runtime.</p><p>While <tt>switch</tt> covers a lot of territory. two more dispatch mechanisms in Java are <tt>if</tt> and the ternary operator <tt>x?y:z</tt>, both of which dispatch on booleans. The ternary operator, unlike <tt>switch</tt> and <tt>if</tt>, is an expression instead of a statement meaning it returns a useful value that can be used in larger expressions. Similar to the <tt>if</tt> vs ternary operator distinction, it's possible to create Visitors that that can be used in expressions or others that are only called for their effects such as modifying a shared data structure, writing to the network, or printing to the screen.</p><p>An example Visitor should help - we'll reimplement a method that uses <tt>x?y:z</tt> to use a Visitor pattern to tie all the concepts together. </p><p>First, we need a boolean surrogate. Ignore the <tt>accept</tt> methods for now.</p><div class="source"><pre class="prettyprint">public interface MyBoolean {
    public &lt;T&gt; T accept(MyBooleanVisitor&lt;T&gt; visitor);
}
</pre></div><div class="source"><pre class="prettyprint">public class MyTrue implements MyBoolean {
    @Override
    public &lt;T&gt; T accept(MyBooleanVisitor&lt;T&gt; visitor) {
        return visitor.visitMyTrue(this);
    }
}
</pre></div><div class="source"><pre class="prettyprint">public class MyFalse implements MyBoolean {
    @Override
    public &lt;T&gt; T accept(MyBooleanVisitor&lt;T&gt; visitor) {
        return visitor.visitMyFalse(this);
    }
}
</pre></div><p>So a MyBoolean is either a MyTrue or a MyFalse. Technically MyBoolean includes any other subclass that anybody wants to write, but the Visitor pattern effectively prevents such subclassing as you'll see shortly. </p><p>The first half of the visitor pattern is the abstract accept method in the base interface or class and concrete implementations in each subclass. The second half is the visitor interface</p><div class="source"><pre class="prettyprint">public interface MyBooleanVisitor&lt;ResultType&gt; {
    ResultType visitMyTrue(MyTrue x);
    ResultType visitMyFalse(MyFalse x);
}
</pre></div><p>So anything that implements MyBooleanInterface can be passed to the accept method on a MyBoolean. That accept method will call either visitMyTrue or visitMyFalse on the visitor object. Hence dispatch based on the subclass. That's also why the Visitor pattern effectively prevents adding new subclasses. While it's possible to create <tt>class MyOtherBoolean implemenets MyBoolean</tt>, the only way to make it useful is to go back and add a <tt>visitMyOtherBoolean</tt> to <tt>MyBooleanVisitor</tt> and all its implementations.</p><p>All the Java code you've seen up to now is very similar to the Java that JADT generates, although JADT generates much more, including a Visitor interface variation when you just want effects, and Visitor variations that do default computations so you don't need to implement visit methods for every possible case.</p><p>As promised, we can finally implement an equivalent of the ternary operator. We'll create something similar to this simple method that uses the ternary operator.</p><div class="source"><pre class="prettyprint">public String getAString(boolean x) {
    return x ? &quot;yup&quot; : &quot;nope&quot;;
}
</pre></div><p>Using MyBoolean and implementing a MyBooleanVisitor results in this equivalent method</p><div class="source"><pre class="prettyprint">    public String getAString(MyBoolean x) {
        return x.accept(new MyBooleanVisitor&lt;String&gt;() {
            @Override
            public String visitMyTrue(MyTrue x) {
                return &quot;yup&quot;;
            }

            @Override
            public String visitMyFalse(MyFalse x) {
                return &quot;nope&quot;;
            }
        });
    }
</pre></div><p>There's more boilerplate - it's hard to compete with a built in operator - but the idea is captured.</p><p><a href="./what_adt.html">&lt;&lt; What is an Algebraic DataType? </a> | <a href="./how_adt.html"> How Can Algebraic DataTypes be Used? &gt;&gt;</a></p></div>
                  </div>
            </div>
      
    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span16">Copyright &copy;                   2012.
          All Rights Reserved.      
            
      </div>

                          
        
                </div>
    </footer>
  </body>
</html>
